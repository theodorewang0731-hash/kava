================================================================
KAVA 项目完整执行指令 - 给 AI 助手
================================================================

项目路径：/home/rpwang/kava review

执行以下命令（按顺序）：

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
步骤 1：设置权限
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

cd "/home/rpwang/kava review"
chmod +x run_reproduce_venv.sh
chmod +x fix_permissions.sh
bash fix_permissions.sh


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
步骤 2：激活虚拟环境
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

source venv/bin/activate


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
步骤 3：运行自动化脚本（使用镜像加速）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

bash run_reproduce_venv.sh --method mirror


⏱️  这个步骤会执行：
   - 环境检查（1-2 分钟）
   - 模型下载（20-100 分钟，使用镜像加速约 30-60 分钟）
   - 提交 12 个训练任务

💡 请耐心等待模型下载完成，你会看到如下提示：
   "Downloading meta-llama/Llama-3.2-1B-Instruct..."
   "Downloading meta-llama/Llama-3.2-3B-Instruct..."
   "Downloading Qwen/Qwen2.5-0.5B-Instruct..."


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
步骤 4：确认任务提交成功
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

squeue -u $USER


✅ 预期结果：应该看到 12 个任务（可能状态为 PD=待运行 或 R=运行中）


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
步骤 5：查看任务日志（确认训练正常）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

ls -lh outputs/logs/
tail -30 outputs/logs/kava_*.out


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
步骤 6：定期监控任务（36-48 小时训练期间）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

bash monitor_jobs.sh


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
步骤 7：收集结果（训练完成后，约 36-48 小时后）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

bash collect_results.sh
cat outputs/aggregated_results.csv | column -t -s,


================================================================
重要说明
================================================================

✅ 不需要 conda - 这个新脚本使用已有的 Python venv 环境
✅ 自动下载模型 - 使用 hf-mirror.com 镜像加速
✅ 自动提交任务 - 12 个训练任务（4 configs × 3 seeds）
✅ 自动生成监控脚本 - monitor_jobs.sh 和 collect_results.sh

⏱️  完整时间线：
   - 环境检查：1-2 分钟
   - 模型下载：30-60 分钟（使用镜像）
   - 训练时间：36-48 小时（并行运行）

🎯 任务提交后，可以安全退出终端，SLURM 会继续运行训练任务。

================================================================
故障排查
================================================================

如果步骤 3 出现错误，运行以下诊断：

# 检查虚拟环境
which python
python --version

# 检查磁盘空间
df -h ~

# 检查网络连接
ping -c 3 hf-mirror.com

# 查看详细错误
bash run_reproduce_venv.sh --method mirror 2>&1 | tee debug.log

================================================================

开始执行吧！每步完成后告诉我结果。
